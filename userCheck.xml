<?xml version="1.0" encoding="UTF-8"?>
<service-task-definition>
	<label>CheckTheUserIsInTheGroup</label>
	<label locale="ja">ユーザの指定組織への所属を判定</label>
	<summary>If the specified user is the leader of the specified group,this task returns "L". If the he or she is one of the members of the group,it returns "M".If he or she doesn't belong to the group,it returns nothing.</summary>
	<summary locale="ja">指定したユーザが指定した組織のリーダであれば"L" を、メンバであれば"M" を、所属していなければ空を返します。</summary>
	<configs>
		<config name="userField" form-type="SELECT" select-data-type="QUSER" required="true">
			<label>I1.User Data</label>
			<label locale="ja">I1.ユーザデータ</label>
		</config>
		<config name="groupField" form-type="SELECT" select-data-type="QGROUP" required="true">
			<label>I2.Group Data</label>
			<label locale="ja">I2.組織データ</label>
		</config>
		<config name="result" form-type="SELECT" select-data-type="STRING_TEXTFIELD" required="true">
			<label>O1.Result</label>
			<label locale="ja">O1.結果出力先</label>
		</config>
	</configs>
	<script><![CDATA[
		var user = engine.findDataByNumber(configs.get("userField"));
		var group = engine.findDataByNumber(configs.get("groupField"));
		var result = "";
		var temp = ""

		function check(list,LM){
		  for (var i = 0;i<list.size();i++){
		  	temp = list.get(i);
		  	if(user.getId().equals(temp.getId())){
		  		result = LM;
		  	}
		  }
		}

		var listL = quserDao.findByQgroupAndPosition(group,true);
		var listM = quserDao.findByQgroupAndPosition(group,false);
		check(listL,"L")
		if (result != "L") {
		  check(listM,"M")
		}

		engine.setDataByNumber(configs.get("result"),result);

]]>
</script>
</service-task-definition>
