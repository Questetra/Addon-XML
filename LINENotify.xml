<?xml version="1.0" encoding="UTF-8"?>
<service-task-definition>
	<label>Post message through LINE Notify</label>
	<label locale="ja">LINE Notifyでメッセージ投稿</label>
	<summary>Post message to your LINE Group through LINE Notify.In advance you have to get a personal access token.When get the one,choose where messages are sent.</summary>
	<summary locale="ja">LINE Notifyを通してLINEグループにメッセージを投稿します。事前にパーソナルアクセストークンを取得してください。送信先はトークンを取得するユーザー本人、またはその人の参加しているグループの中からトークン取得時に選択します。</summary>
	<configs>
		<config name="token" form-type="TEXTFIELD" required="true">
		<label>C1.access token(Message will be sent to the person or group chosen when the token is generated)</label>
		<label locale="ja">C1.アクセストークン(メッセージは取得時に指定したグループまたは個人へ送信されます)</label>
		</config>
		<config name="Message" form-type="SELECT" select-data-type="STRING" required="true">
		<label>I1.Text Message</label>
		<label locale="ja">I1.テキスト</label>
		</config>
	</configs>
	<script><![CDATA[
main();
	
function main(){
	var token = configs.get("token");
	var message = engine.findDataByNumber(configs.get("Message"));
	//send message to LINE Notify API
	var response = httpClient.begin()
	 .bearer(token)
 	 .multipart("message", message)
 	 .post('https://notify-api.line.me/api/notify');
	var responseText = response.getResponseAsString();
	var json = JSON.parse(responseText);
	//check whether sending succeeded
	if (response.getStatusCode() != 200) {
		throw new Error("Status code is not 200. " + response.getStatusCode() + ".\n" +"Message:" + json["message"]) ;
	}else{
		engine.log("status code is 200. " + ".\n" +"Message:" + json["message"])
	}
}

]]>
</script>
</service-task-definition>