<?xml version="1.0" encoding="UTF-8"?>
<service-task-definition>
<label>Converter (Table to Excel-CSV FILE)</label>
<label locale="ja">コンバータ (テーブル型データをエクセル対応のCSVファイルに)</label>  <!--t6846対応　日本語に-->
<last-modified>2019-09-17</last-modified>
<help-page-url>https://support.questetra.com/addons/converter-tabletoexcelcsv/</help-page-url>
<help-page-url locale="ja">https://support.questetra.com/ja/addons/converter-tabletoexcelcsv/</help-page-url>
<configs>
<config name="Table_DataId" select-data-type="LIST" form-type="SELECT" required="true"><!--T6846対応-->
<label>A: Select TABLE DATA</label>
<label locale="ja">A: テーブル型データを選択してください</label>
</config>
<!--<config name="conf_ColIds" form-type="TEXTFIELD" required="true">//T6846対応　削除
<label>B: Set COL IDs for Extraction (e.g. "0,1,5,3,6")</label>
<label locale="ja">B: 抽出データのカラム ID をセットしてください (例 "0,1,5,3,6")</label>
</config>
-->
<config name="File_NameId" form-type="TEXTFIELD" required="true" el-enabled="true"><!--//T6846対応　テキストフィールドEL式可に--> 
<label>B: Set File Name</label>
<label locale="ja">B: ファイル名を入力してください</label>
</config>
<config name="File_DataId" select-data-type="FILE" form-type="SELECT" required="true"><!--T6846対応-->
<label>C: Select FILE DATA (append)</label>
<label locale="ja">C: ファイル型データを選択してください（追加）</label>
</config>
</configs>
<engine-type>1</engine-type>
<script>
<![CDATA[

// Converter from Table to Excel-CSV (ver. 20180829)
// (c) 2018, Questetra, Inc. (the MIT License)

//// == Config Retrieving / 工程コンフィグの参照 ==
const tableId = configs.get( "Table_DataId" ) + "";//T6846
//const colIds  = configs.get( "conf_ColIds" )  + "";T6846削除
const fnameId = configs.get( "File_NameId" ) + "";//T6846
const fileId = configs.get( "File_DataId" ) + "";//T6846

if(fnameId === "" ||fnameId === null) {
    throw new Error( "File Name is blank" );
  }//T6846

//// == Data Retrieving / ワークフローデータの参照 ==
const myTable = engine.findDataByNumber( tableId );//T6846
// com.questetra.bpms.core.model.formdata.ListArray
//const fileName = engine.findDataByNumber( fnameId ) + "";//T6846
let   myFiles  = engine.findDataByNumber( fileId );// java.util.ArrayList T6846
if( myFiles === null ){ myFiles = new java.util.ArrayList(); }

if( myTable === null){
  //throw new Error( "Source Table data is NULL" ); t6846 空のテーブルでも空のファイルを保存するよう変更

let myTsv = "";
myFiles.add(
  new com.questetra.bpms.core.event.scripttask.NewQfile(
    fnameId,
    "text/tab-separated-values; charset=x-UTF-16LE-BOM",
    myTsv
  )
);

}

else{

//// == Calculating / 演算 ==
//let colIdArray = colIds.split(","); t6846対応 全カラム対象に　削除
//let numOfCols = colIdArray.length; t6846対応　全カラム対象に　削除
let numOfRows = myTable.size() - 0; // 行（Tableの高さ）
let numOfCols = myTable.getRow(0).size(); // 列（Tableの幅）t6846対応

let myTsv = "";

for( let i = 0; i < numOfRows; i++ ){
  for( let j = 0; j < numOfCols; j++ ){
    myTsv += myTable.get(i, j ) + ""; //t6846対応
    if( j != numOfCols - 1 ){
      myTsv += "\t";
    }
  }
  if( i != numOfRows - 1 ){
    myTsv += "\n";
  }
}

myFiles.add(
  new com.questetra.bpms.core.event.scripttask.NewQfile(
    fnameId,
    "text/tab-separated-values; charset=x-UTF-16LE-BOM",
    myTsv
  )
);

}


//// == Data Updating / ワークフローデータへの代入 ==
engine.setDataByNumber( fileId, myFiles );

]]>
</script>
<icon> iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACx0lEQVRYR8WXz0sUYRjHP5O0CLX+ uHTIQ7sHIby0BdIh0EU6hwmd20Vx9mb9AUvlQQSRVhBq0WW3gxcFKzx4000kBKO2QNgSssgS6uDu oQQJJt4ZZ3ecH+s4O+kLyy7s+z7fz/PM87zPMxKnvKRj6afpBbpRiCDRAkQOzhdQKCEhvvMkeOnW 7tEAWVrYZwi4B6qom1UCUgSYII747bhqAzwhxhkeH0PYLCTE48i8cCJwBnhKCkn13I+VQua+nSF7 gDQ54K4fyhUbCjkSxM02rQD+en5YT2GChJpLlXUYQHvmWV89txq7bcyJKoCW7Vt1JJxb7hIBwnp1 VAHSPAQeuLVSa99U1xTzW/Msflt02vYIWdXDCCBKptkPgI07GzQFmhhcGXSCKCHTWgXQbrjnRvGe iz20nWvzxJO8lqS9uZ3t39u1INRc0CJgk/nCi47WDk8AxkOOEAcVoQGkyat3vGH5BbD3d4/RwijD b4fNzrxCJqoDfAEuGXdMd03TeaHTUwRC50NqDgjx8Q/jJN8k7ewUkLmqAyielBwOieiFg+Fa4tpJ GelIgODZIJnuDDt/dhh67a41rN5aZfnHspPnVWwDgOURiF1CPBvN0hvqJfcxx8DKgH+BUnhPgohj EhrFG6QG1n6usVne9ASw9H2J3CfR3w4tQxLalOHszVn6wn0I8XpXppixRs9UhpaLaPLGJP2X+2ls aKxXH1sAMFxE2l1guYqNEHOf51j4uuAJplgqsv5r3Xi2jKyNd0c2Ix1iZnPGzyS0aUZaOxbVYGlI Y9fH2N3fZeTdiKcImA6VCRCytmOx61QHEh3zf45kUAm9LndyQyk8QyZmfoYnNZZbPK8dAf1fbVAR V5jXSakMxLy9mOgQWnWIUVp83IIIYfFqlqrv1cz8wEREFKJIRFBoQeKKukU0FokSCgUk8rU8dp8D flS8Cxv/AFp57iGwqv7bAAAAAElFTkSuQmCC </icon>
</service-task-definition>
